#!/usr/bin/env ruby

require 'shellwords'
require 'resolv'
require 'fileutils'

user = "tom"
host = "owlbear"
smut_path = Pathname.new("/home/tom/.porn/Unsorted")

begin
  Resolv.getaddress host
rescue Resolv::ResolvError
  puts "Unable to resolve hostname \"#{host}\"; aborting"
  abort
end

ARGV.each do |fn|
  unless File.exist? fn
    puts "File `fn` does not exist; skipping"
    next
  end

  `scp #{Shellwords.shellescape fn} #{user}@#{host}:#{Shellwords.shellescape(smut_path + fn)}`

  puts "removing #{fn}"
  FileUtils.rm fn
end